{"remainingRequest":"/Users/songyu/IdeaProjects/yiqing-admin-1/node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!/Users/songyu/IdeaProjects/yiqing-admin-1/src/views/Permission/Role.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/songyu/IdeaProjects/yiqing-admin-1/src/views/Permission/Role.vue","mtime":1619502198161},{"path":"/Users/songyu/IdeaProjects/yiqing-admin-1/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/songyu/IdeaProjects/yiqing-admin-1/node_modules/_babel-loader@8.2.3@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/songyu/IdeaProjects/yiqing-admin-1/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/songyu/IdeaProjects/yiqing-admin-1/node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnCmltcG9ydCB7IGRlZXBDbG9uZSB9IGZyb20gJ0AvdXRpbHMnCmltcG9ydCB7IGdldFJvdXRlcywgZ2V0Um9sZXMsIGFkZFJvbGUsIGRlbGV0ZVJvbGUgfSBmcm9tICdAL2FwaS9yb2xlJwppbXBvcnQge2NvbnN0YW50Um91dGVzLCBhc3luY1JvdXRlc30gZnJvbSAiQC9yb3V0ZXIiOwppbXBvcnQge2dldE1lbnVzfSBmcm9tICJAL2FwaS9tZW51IjsKaW1wb3J0IHt1cGRhdGVSb2xlfSBmcm9tICJAL2FwaS9yb2xlIjsKCmNvbnN0IGRlZmF1bHRSb2xlID0gewogIGtleTogJycsCiAgbmFtZTogJycsCiAgZGVzY3JpcHRpb246ICcnLAogIHJvdXRlczogW10KfQoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICByb2xlOiBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0Um9sZSksCiAgICAgIHJvdXRlczogW10sCiAgICAgIHJvbGVzTGlzdDogW10sCiAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICBkaWFsb2dUeXBlOiAnbmV3JywKICAgICAgY2hlY2tTdHJpY3RseTogZmFsc2UsCiAgICAgIGRlZmF1bHRQcm9wczogewogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLAogICAgICAgIGxhYmVsOiAndGl0bGUnCiAgICAgIH0KICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICByb3V0ZXNEYXRhKCkgewogICAgICByZXR1cm4gdGhpcy5yb3V0ZXMKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICAvLyBNb2NrOiBnZXQgYWxsIHJvdXRlcyBhbmQgcm9sZXMgbGlzdCBmcm9tIHNlcnZlcgogICAgLy8gdGhpcy5yb3V0ZXMgPSBkZWVwQ2xvbmUoWy4uLmNvbnN0YW50Um91dGVzLCAuLi5hc3luY1JvdXRlc10pCiAgICAvLyB0aGlzLnJvdXRlcyA9IHRoaXMuZ2VuZXJhdGVSb3V0ZXModGhpcy5yb3V0ZXMpCiAgICB0aGlzLmdldFJvdXRlcygpCiAgICB0aGlzLmdldFJvbGVzKCkKICAgIC8vIGNvbnNvbGUubG9nKCJ0aGlzLnJvdXRlcyIsIHRoaXMuc2VydmljZVJvdXRlcykKICB9LAogIG1ldGhvZHM6IHsKICAgIGFzeW5jIGdldFJvdXRlcygpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0TWVudXModGhpcy4kc3RvcmUuc3RhdGUudXNlci5yb2xlc1swXSkgIC8v6L+Z5Liq5piv5ZCm5a+577yfCiAgICAgIHRoaXMuc2VydmljZVJvdXRlcyA9IHJlcy5kYXRhCiAgICAgIHRoaXMucm91dGVzID0gdGhpcy5nZW5lcmF0ZVJvdXRlcyhyZXMuZGF0YSkgIC8vZm9yIHRyZWUKICAgICAgY29uc29sZS5sb2coJ3JvdXRlcycsIHRoaXMucm91dGVzKQogICAgICAvLyB0aGlzLnNlcnZpY2VSb3V0ZXMgPSB0aGlzLmdlbmVyYXRlUm91dGVzKHJlcy5kYXRhKSAgLy/ku4XmmK/mtYvor5UKICAgICAgLy8gdGhpcy5yb2xlLnJvdXRlcyA9IHRoaXMuZ2VuZXJhdGVSb3V0ZXMocmVzLmRhdGEpICAvL+S7heaYr+a1i+ivlQogICAgfSwKCiAgICBhc3luYyBnZXRSb2xlcygpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0Um9sZXMoKQogICAgICAvLyBjb25zb2xlLmxvZygnZ2V0Um9sZXMnLCByZXMpCiAgICAgIHRoaXMucm9sZXNMaXN0ID0gcmVzLmRhdGEKICAgICAgLy8gdGhpcy5zZXJ2aWNlUm91dGVzID0gdGhpcy5nZW5lcmF0ZVJvdXRlcyhyZXMuZGF0YSkKICAgIH0sCgogICAgLy8gUmVzaGFwZSB0aGUgcm91dGVzIHN0cnVjdHVyZSBzbyB0aGF0IGl0IGxvb2tzIHRoZSBzYW1lIGFzIHRoZSBzaWRlYmFyCiAgICBnZW5lcmF0ZVJvdXRlcyhyb3V0ZXMsIGJhc2VQYXRoID0gJy8nKSB7CiAgICAgIGNvbnN0IHJlcyA9IFtdCiAgICAgIGZvciAobGV0IHJvdXRlIG9mIHJvdXRlcykgewogICAgICAgIC8vIHNraXAgc29tZSByb3V0ZQogICAgICAgIC8vIGNvbnNvbGUubG9nKCdyb3V0ZTAnLCByb3V0ZSkKICAgICAgICBpZiAocm91dGUuaGlkZGVuKSB7IGNvbnRpbnVlIH0KICAgICAgICBjb25zdCBvbmx5T25lU2hvd2luZ0NoaWxkID0gdGhpcy5vbmx5T25lU2hvd2luZ0NoaWxkKHJvdXRlLmNoaWxkcmVuLCByb3V0ZSkKICAgICAgICBpZiAocm91dGUuY2hpbGRyZW4gJiYgb25seU9uZVNob3dpbmdDaGlsZCAgJiYgIXJvdXRlLmFsd2F5c1Nob3cpIHsKICAgICAgICAgIHJvdXRlID0gb25seU9uZVNob3dpbmdDaGlsZAogICAgICAgIH0KICAgICAgICAvLyBjb25zb2xlLmxvZygncm91dGUnLCByb3V0ZSkKICAgICAgICBjb25zdCBkYXRhID0gewogICAgICAgICAgcGF0aDogcGF0aC5yZXNvbHZlKGJhc2VQYXRoLCByb3V0ZS5wYXRoKSwKICAgICAgICAgIHRpdGxlOiByb3V0ZS5tZXRhICYmIHJvdXRlLm1ldGEudGl0bGUsCiAgICAgICAgICBpZDogcm91dGUuaWQKICAgICAgICB9CiAgICAgICAgLy8gY29uc29sZS5sb2coJ2RhdGEnLCBkYXRhKQogICAgICAgIC8vIHJlY3Vyc2l2ZSBjaGlsZCByb3V0ZXMKICAgICAgICBpZiAocm91dGUuY2hpbGRyZW4pIHsKICAgICAgICAgIGRhdGEuY2hpbGRyZW4gPSB0aGlzLmdlbmVyYXRlUm91dGVzKHJvdXRlLmNoaWxkcmVuLCBkYXRhLnBhdGgpCiAgICAgICAgfQogICAgICAgIHJlcy5wdXNoKGRhdGEpCiAgICAgIH0KICAgICAgcmV0dXJuIHJlcwogICAgfSwKICAgIGdlbmVyYXRlQXJyKHJvdXRlcykgewogICAgICBsZXQgZGF0YSA9IFtdCiAgICAgIHJvdXRlcy5mb3JFYWNoKHJvdXRlID0+IHsKICAgICAgICBkYXRhLnB1c2gocm91dGUpCiAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuKSB7CiAgICAgICAgICBjb25zdCB0ZW1wID0gdGhpcy5nZW5lcmF0ZUFycihyb3V0ZS5jaGlsZHJlbikKICAgICAgICAgIGlmICh0ZW1wLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZGF0YSA9IFsuLi5kYXRhLCAuLi50ZW1wXQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkKICAgICAgcmV0dXJuIGRhdGEKICAgIH0sCiAgICBoYW5kbGVBZGRSb2xlKCkgewogICAgICB0aGlzLnJvbGUgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0Um9sZSkKICAgICAgaWYgKHRoaXMuJHJlZnMudHJlZSkgewogICAgICAgIHRoaXMuJHJlZnMudHJlZS5zZXRDaGVja2VkTm9kZXMoW10pCiAgICAgIH0KICAgICAgdGhpcy5kaWFsb2dUeXBlID0gJ25ldycKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgfSwKICAgIGhhbmRsZUVkaXQoc2NvcGUpIHsKICAgICAgdGhpcy5kaWFsb2dUeXBlID0gJ2VkaXQnCiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWUKICAgICAgdGhpcy5jaGVja1N0cmljdGx5ID0gdHJ1ZQogICAgICB0aGlzLnJvbGUgPSBkZWVwQ2xvbmUoc2NvcGUucm93KQogICAgICBjb25zb2xlLmxvZygncm9sZScsIHRoaXMucm9sZSkKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIC8vY29uc3Qgcm91dGVzID0gdGhpcy5nZW5lcmF0ZVJvdXRlcyh0aGlzLnJvbGUucm91dGVzID09IG51bGwgPyBbXSA6IHRoaXMucm9sZS5yb3V0ZXMpCiAgICAgICAgY29uc3QgZCA9IHRoaXMuZ2VuZXJhdGVBcnIodGhpcy5yb2xlLnJvdXRlcyApCiAgICAgICAgY29uc29sZS5sb2coJ2QnLCBkKQogICAgICAgIGNvbnNvbGUubG9nKCdyb3V0ZXNEYXRhJywgdGhpcy5yb3V0ZXNEYXRhKSAgIC8v6L+Z5Liq5pyJYnVnCiAgICAgICAgdGhpcy4kcmVmcy50cmVlLnNldENoZWNrZWROb2RlcyhkKQogICAgICAgIC8vIHNldCBjaGVja2VkIHN0YXRlIG9mIGEgbm9kZSBub3QgYWZmZWN0cyBpdHMgZmF0aGVyIGFuZCBjaGlsZCBub2RlcwogICAgICAgIHRoaXMuY2hlY2tTdHJpY3RseSA9IGZhbHNlCiAgICAgIH0pCiAgICB9LAogICAgaGFuZGxlRGVsZXRlKHsgJGluZGV4LCByb3cgfSkgewogICAgICB0aGlzLiRjb25maXJtKCdDb25maXJtIHRvIHJlbW92ZSB0aGUgcm9sZT8nLCAnV2FybmluZycsIHsKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ0NvbmZpcm0nLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICdDYW5jZWwnLAogICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICB9KQogICAgICAgIC50aGVuKGFzeW5jKCkgPT4gewogICAgICAgICAgYXdhaXQgZGVsZXRlUm9sZShyb3cua2V5KQogICAgICAgICAgdGhpcy5yb2xlc0xpc3Quc3BsaWNlKCRpbmRleCwgMSkKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsCiAgICAgICAgICAgIG1lc3NhZ2U6ICdEZWxldGUgc3VjY2VkIScKICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZXJyID0+IHsgY29uc29sZS5lcnJvcihlcnIpIH0pCiAgICB9LAogICAgZ2VuZXJhdGVUcmVlKHJvdXRlcywgYmFzZVBhdGggPSAnLycsIGNoZWNrZWRLZXlzKSB7CiAgICAgIGNvbnN0IHJlcyA9IFtdCgogICAgICBmb3IgKGNvbnN0IHJvdXRlIG9mIHJvdXRlcykgewogICAgICAgIGNvbnN0IHJvdXRlUGF0aCA9IHBhdGgucmVzb2x2ZShiYXNlUGF0aCwgcm91dGUucGF0aCkKCiAgICAgICAgLy8gcmVjdXJzaXZlIGNoaWxkIHJvdXRlcwogICAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbikgewogICAgICAgICAgcm91dGUuY2hpbGRyZW4gPSB0aGlzLmdlbmVyYXRlVHJlZShyb3V0ZS5jaGlsZHJlbiwgcm91dGVQYXRoLCBjaGVja2VkS2V5cykKICAgICAgICB9CgogICAgICAgIGlmIChjaGVja2VkS2V5cy5pbmNsdWRlcyhyb3V0ZVBhdGgpIHx8IChyb3V0ZS5jaGlsZHJlbiAmJiByb3V0ZS5jaGlsZHJlbi5sZW5ndGggPj0gMSkpIHsKICAgICAgICAgIHJlcy5wdXNoKHJvdXRlKQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzCiAgICB9LAogICAgYXN5bmMgY29uZmlybVJvbGUoKSB7CiAgICAgIGNvbnN0IGlzRWRpdCA9IHRoaXMuZGlhbG9nVHlwZSA9PT0gJ2VkaXQnCgogICAgICBjb25zdCBjaGVja2VkS2V5cyA9IHRoaXMuJHJlZnMudHJlZS5nZXRDaGVja2VkS2V5cygpCiAgICAgIHRoaXMucm9sZS5yb3V0ZXMgPSB0aGlzLmdlbmVyYXRlVHJlZShkZWVwQ2xvbmUodGhpcy5zZXJ2aWNlUm91dGVzKSwgJy8nLCBjaGVja2VkS2V5cykKCiAgICAgIGlmIChpc0VkaXQpIHsKICAgICAgICBhd2FpdCB1cGRhdGVSb2xlKHRoaXMucm9sZSkKICAgICAgICAvL+abv+aNouaVsOaNru+8nwogICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLnJvbGVzTGlzdC5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgIGlmICh0aGlzLnJvbGVzTGlzdFtpbmRleF0ua2V5ID09PSB0aGlzLnJvbGUua2V5KSB7CiAgICAgICAgICAgIHRoaXMucm9sZXNMaXN0LnNwbGljZShpbmRleCwgMSwgT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5yb2xlKSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBhZGRSb2xlKHRoaXMucm9sZSkKICAgICAgICB0aGlzLnJvbGUua2V5ID0gZGF0YS5rZXkKICAgICAgICB0aGlzLnJvbGVzTGlzdC5wdXNoKHRoaXMucm9sZSkKICAgICAgfQoKICAgICAgY29uc3QgeyBkZXNjcmlwdGlvbiwga2V5LCBuYW1lIH0gPSB0aGlzLnJvbGUKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2UKICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICB0aXRsZTogJ1N1Y2Nlc3MnLAogICAgICAgIGRhbmdlcm91c2x5VXNlSFRNTFN0cmluZzogdHJ1ZSwKICAgICAgICBtZXNzYWdlOiBgCiAgICAgICAgICAgIDxkaXY+Um9sZSBLZXk6ICR7a2V5fTwvZGl2PgogICAgICAgICAgICA8ZGl2PlJvbGUgTmFtZTogJHtuYW1lfTwvZGl2PgogICAgICAgICAgICA8ZGl2PkRlc2NyaXB0aW9uOiAke2Rlc2NyaXB0aW9ufTwvZGl2PgogICAgICAgICAgYCwKICAgICAgICB0eXBlOiAnc3VjY2VzcycKICAgICAgfSkKICAgIH0sCiAgICAvLyByZWZlcmVuY2U6IHNyYy92aWV3L2xheW91dC9jb21wb25lbnRzL1NpZGViYXIvU2lkZWJhckl0ZW0udnVlCiAgICBvbmx5T25lU2hvd2luZ0NoaWxkKGNoaWxkcmVuID0gW10sIHBhcmVudCkgewogICAgICBsZXQgb25seU9uZUNoaWxkID0gbnVsbAogICAgICBjb25zdCBzaG93aW5nQ2hpbGRyZW4gPSBjaGlsZHJlbi5maWx0ZXIoaXRlbSA9PiAhaXRlbS5oaWRkZW4pCgogICAgICAvLyBXaGVuIHRoZXJlIGlzIG9ubHkgb25lIGNoaWxkIHJvdXRlLCB0aGUgY2hpbGQgcm91dGUgaXMgZGlzcGxheWVkIGJ5IGRlZmF1bHQKICAgICAgaWYgKHNob3dpbmdDaGlsZHJlbi5sZW5ndGggPT09IDEpIHsKICAgICAgICBvbmx5T25lQ2hpbGQgPSBzaG93aW5nQ2hpbGRyZW5bMF0KICAgICAgICBvbmx5T25lQ2hpbGQucGF0aCA9IHBhdGgucmVzb2x2ZShwYXJlbnQucGF0aCwgb25seU9uZUNoaWxkLnBhdGgpCiAgICAgICAgcmV0dXJuIG9ubHlPbmVDaGlsZAogICAgICB9CgogICAgICAvLyBTaG93IHBhcmVudCBpZiB0aGVyZSBhcmUgbm8gY2hpbGQgcm91dGUgdG8gZGlzcGxheQogICAgICBpZiAoc2hvd2luZ0NoaWxkcmVuLmxlbmd0aCA9PT0gMCkgewogICAgICAgIG9ubHlPbmVDaGlsZCA9IHsgLi4uIHBhcmVudCwgcGF0aDogJycsIG5vU2hvd2luZ0NoaWxkcmVuOiB0cnVlIH0KICAgICAgICByZXR1cm4gb25seU9uZUNoaWxkCiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZQogICAgfQogIH0KfQo="},{"version":3,"sources":["Role.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"Role.vue","sourceRoot":"src/views/Permission","sourcesContent":["<template>\n  <div class=\"app-container\">\n<!--    <el-button type=\"primary\" @click=\"handleAddRole\">New Role</el-button>-->\n\n    <el-table :data=\"rolesList\" style=\"width: 100%;margin-top:30px;\" border>\n      <el-table-column align=\"center\" label=\"权限英文名\" width=\"220\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.key }}\n        </template>\n      </el-table-column>\n      <el-table-column align=\"center\" label=\"权限名\" width=\"220\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.name }}\n        </template>\n      </el-table-column>\n      <el-table-column align=\"header-center\" label=\"描述\">\n        <template slot-scope=\"scope\">\n          {{ scope.row.description }}\n        </template>\n      </el-table-column>\n      <el-table-column align=\"center\" label=\"操作\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"primary\" size=\"small\" @click=\"handleEdit(scope)\">编辑</el-button>\n          <el-button type=\"danger\" disabled size=\"small\" @click=\"handleDelete(scope)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <el-dialog :visible.sync=\"dialogVisible\" :title=\"dialogType==='edit'?'编辑 角色':'新增 角色'\">\n      <el-form :model=\"role\" label-width=\"80px\" label-position=\"left\">\n        <el-form-item label=\"名称\">\n          <el-input v-model=\"role.name\" placeholder=\"Role Name\" />\n        </el-form-item>\n        <el-form-item label=\"描述\">\n          <el-input\n            v-model=\"role.description\"\n            :autosize=\"{ minRows: 2, maxRows: 4}\"\n            type=\"textarea\"\n            placeholder=\"Role Description\"\n          />\n        </el-form-item>\n        <el-form-item label=\"菜单\">\n          <el-tree\n            ref=\"tree\"\n            :check-strictly=\"checkStrictly\"\n            :data=\"routesData\"\n            :props=\"defaultProps\"\n            show-checkbox\n            node-key=\"path\"\n            class=\"permission-tree\"\n          />\n        </el-form-item>\n      </el-form>\n      <div style=\"text-align:right;\">\n        <el-button type=\"danger\" @click=\"dialogVisible=false\">Cancel</el-button>\n        <el-button type=\"primary\" @click=\"confirmRole\">Confirm</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport path from 'path'\nimport { deepClone } from '@/utils'\nimport { getRoutes, getRoles, addRole, deleteRole } from '@/api/role'\nimport {constantRoutes, asyncRoutes} from \"@/router\";\nimport {getMenus} from \"@/api/menu\";\nimport {updateRole} from \"@/api/role\";\n\nconst defaultRole = {\n  key: '',\n  name: '',\n  description: '',\n  routes: []\n}\n\nexport default {\n  data() {\n    return {\n      role: Object.assign({}, defaultRole),\n      routes: [],\n      rolesList: [],\n      dialogVisible: false,\n      dialogType: 'new',\n      checkStrictly: false,\n      defaultProps: {\n        children: 'children',\n        label: 'title'\n      }\n    }\n  },\n  computed: {\n    routesData() {\n      return this.routes\n    }\n  },\n  created() {\n    // Mock: get all routes and roles list from server\n    // this.routes = deepClone([...constantRoutes, ...asyncRoutes])\n    // this.routes = this.generateRoutes(this.routes)\n    this.getRoutes()\n    this.getRoles()\n    // console.log(\"this.routes\", this.serviceRoutes)\n  },\n  methods: {\n    async getRoutes() {\n      const res = await getMenus(this.$store.state.user.roles[0])  //这个是否对？\n      this.serviceRoutes = res.data\n      this.routes = this.generateRoutes(res.data)  //for tree\n      console.log('routes', this.routes)\n      // this.serviceRoutes = this.generateRoutes(res.data)  //仅是测试\n      // this.role.routes = this.generateRoutes(res.data)  //仅是测试\n    },\n\n    async getRoles() {\n      const res = await getRoles()\n      // console.log('getRoles', res)\n      this.rolesList = res.data\n      // this.serviceRoutes = this.generateRoutes(res.data)\n    },\n\n    // Reshape the routes structure so that it looks the same as the sidebar\n    generateRoutes(routes, basePath = '/') {\n      const res = []\n      for (let route of routes) {\n        // skip some route\n        // console.log('route0', route)\n        if (route.hidden) { continue }\n        const onlyOneShowingChild = this.onlyOneShowingChild(route.children, route)\n        if (route.children && onlyOneShowingChild  && !route.alwaysShow) {\n          route = onlyOneShowingChild\n        }\n        // console.log('route', route)\n        const data = {\n          path: path.resolve(basePath, route.path),\n          title: route.meta && route.meta.title,\n          id: route.id\n        }\n        // console.log('data', data)\n        // recursive child routes\n        if (route.children) {\n          data.children = this.generateRoutes(route.children, data.path)\n        }\n        res.push(data)\n      }\n      return res\n    },\n    generateArr(routes) {\n      let data = []\n      routes.forEach(route => {\n        data.push(route)\n        if (route.children) {\n          const temp = this.generateArr(route.children)\n          if (temp.length > 0) {\n            data = [...data, ...temp]\n          }\n        }\n      })\n      return data\n    },\n    handleAddRole() {\n      this.role = Object.assign({}, defaultRole)\n      if (this.$refs.tree) {\n        this.$refs.tree.setCheckedNodes([])\n      }\n      this.dialogType = 'new'\n      this.dialogVisible = true\n    },\n    handleEdit(scope) {\n      this.dialogType = 'edit'\n      this.dialogVisible = true\n      this.checkStrictly = true\n      this.role = deepClone(scope.row)\n      console.log('role', this.role)\n      this.$nextTick(() => {\n        //const routes = this.generateRoutes(this.role.routes == null ? [] : this.role.routes)\n        const d = this.generateArr(this.role.routes )\n        console.log('d', d)\n        console.log('routesData', this.routesData)   //这个有bug\n        this.$refs.tree.setCheckedNodes(d)\n        // set checked state of a node not affects its father and child nodes\n        this.checkStrictly = false\n      })\n    },\n    handleDelete({ $index, row }) {\n      this.$confirm('Confirm to remove the role?', 'Warning', {\n        confirmButtonText: 'Confirm',\n        cancelButtonText: 'Cancel',\n        type: 'warning'\n      })\n        .then(async() => {\n          await deleteRole(row.key)\n          this.rolesList.splice($index, 1)\n          this.$message({\n            type: 'success',\n            message: 'Delete succed!'\n          })\n        })\n        .catch(err => { console.error(err) })\n    },\n    generateTree(routes, basePath = '/', checkedKeys) {\n      const res = []\n\n      for (const route of routes) {\n        const routePath = path.resolve(basePath, route.path)\n\n        // recursive child routes\n        if (route.children) {\n          route.children = this.generateTree(route.children, routePath, checkedKeys)\n        }\n\n        if (checkedKeys.includes(routePath) || (route.children && route.children.length >= 1)) {\n          res.push(route)\n        }\n      }\n      return res\n    },\n    async confirmRole() {\n      const isEdit = this.dialogType === 'edit'\n\n      const checkedKeys = this.$refs.tree.getCheckedKeys()\n      this.role.routes = this.generateTree(deepClone(this.serviceRoutes), '/', checkedKeys)\n\n      if (isEdit) {\n        await updateRole(this.role)\n        //替换数据？\n        for (let index = 0; index < this.rolesList.length; index++) {\n          if (this.rolesList[index].key === this.role.key) {\n            this.rolesList.splice(index, 1, Object.assign({}, this.role))\n            break\n          }\n        }\n      } else {\n        const { data } = await addRole(this.role)\n        this.role.key = data.key\n        this.rolesList.push(this.role)\n      }\n\n      const { description, key, name } = this.role\n      this.dialogVisible = false\n      this.$notify({\n        title: 'Success',\n        dangerouslyUseHTMLString: true,\n        message: `\n            <div>Role Key: ${key}</div>\n            <div>Role Name: ${name}</div>\n            <div>Description: ${description}</div>\n          `,\n        type: 'success'\n      })\n    },\n    // reference: src/view/layout/components/Sidebar/SidebarItem.vue\n    onlyOneShowingChild(children = [], parent) {\n      let onlyOneChild = null\n      const showingChildren = children.filter(item => !item.hidden)\n\n      // When there is only one child route, the child route is displayed by default\n      if (showingChildren.length === 1) {\n        onlyOneChild = showingChildren[0]\n        onlyOneChild.path = path.resolve(parent.path, onlyOneChild.path)\n        return onlyOneChild\n      }\n\n      // Show parent if there are no child route to display\n      if (showingChildren.length === 0) {\n        onlyOneChild = { ... parent, path: '', noShowingChildren: true }\n        return onlyOneChild\n      }\n\n      return false\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.app-container {\n  .roles-table {\n    margin-top: 30px;\n  }\n  .permission-tree {\n    margin-bottom: 30px;\n  }\n}\n</style>\n"]}]}